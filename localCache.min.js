// Copyright 2012-2013 St√©phane Lavergne <http://www.imars.com/> Free software under <http://www.gnu.org/licenses/lgpl-3.0.txt>
(function(window){"use strict";window.localCache={_dirties:{},_dirty:function(){},_update:function(){},_thaw:function(){return{}},_fetcher:function(a,t,e,o,l){localCache.hasOwnProperty(a)||(localCache[a]=localCache._thaw(a),localCache["_"+a]={}),localCache[a].hasOwnProperty(t)?"function"==typeof l&&l(localCache[a][t]):localCache["_"+a].hasOwnProperty(t)?localCache["_"+a][t].push(l):(localCache["_"+a][t]=[l],e(o,function(e){for(localCache._dirty(a),localCache[a][t]=e;localCache["_"+a][t].length>0;){var o=localCache["_"+a][t].pop();"function"==typeof o&&o(e)}delete localCache["_"+a][t]}))},_init:function(a){if(window.localStorage===void 0&&window.sessionStorage!==void 0&&(window.localStorage=window.sessionStorage),window.localStorage===void 0){var t=document.createElement("div");t.style.display="none",document.body.appendChild(t);try{t.style.behavior="url('#default#userdata')",t.load("localStorage"),window.localStorage={div:t,stash:{},getItem:function(a){return localStorage.stash[a]},setItem:function(a,t){localStorage.stash[a]=t,localStorage._update()},removeItem:function(a){delete localStorage.stash[a],localStorage._update()},clear:function(){localStorage.stash={},localStorage._update()},length:function(){var a,t=0;for(a in localStorage.stash)localStorage.stash.hasOwnProperty(a)&&t++;return t},key:function(a){var t,e=0;for(t in localStorage.stash)if(localStorage.stash.hasOwnProperty(t)){if(e===a)return t;e++}return null},_update:function(){localStorage.div.setAttribute("stash",JSON.stringify(localStorage.stash)),localStorage.div.save("localStorage")}},t.getAttribute("stash")&&(localStorage.stash=JSON.parse(t.getAttribute("stash")))}catch(e){t.parentNode.removeChild(t)}}if("undefined"!=typeof localStorage)try{null!==a&&localStorage.getItem("_validator")!==a&&(localStorage.clear(),localStorage.setItem("_validator",a)),localCache._thaw=function(a){return localStorage.getItem(a)?JSON.parse(localStorage.getItem(a)):{}},localCache._dirty=function(a){localCache._dirties[a]=!0},localCache._update=function(){var a;for(a in localCache._dirties)localCache._dirties.hasOwnProperty(a)&&(localStorage.setItem(a,JSON.stringify(localCache[a])),delete localCache._dirties[a])}}catch(o){localCache._dirty=function(){},localCache._update=function(){},localCache._thaw=function(){return{}}}}}})(window);